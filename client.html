<!DOCTYPE html>
<html>
   <head>
      <script src="/socket.io/socket.io.js"></script>
   </head>
   <body>
      <div id = "loginPopup">
      <form id = loginForm>
         <label for="username">Username:</label>
         <input type="text" id="username" name="username" required>
         <br><br>
         <label for="existing_rooms">Select a Room:</label>
         <select id="existing_rooms" name="existing_rooms">
            <!--existing room options-->
         </select>
         <br><br>
         <label for="create_room">Create a Room?</label>
         <input type="checkbox" id="create_room" name="create_room">
         <input type="text" placeholder="Input Room Name Here" name="roomName" id="roomName" style="display: none;">
         <br><br>
         <label for="is_private">Private?</label>
         <input type="checkbox" id="is_private" name="is_private">
         <br><br>
         <input type="text" placeholder="Input Password Here" id="roomPassword" style="display: none;">
         <br>
         <input type="submit" value="Join/Create">
      </form>
      </div>
      
      <input type=text id="message_input"/>
      <button onclick="sendMessage()">send</button>
      <div id="chatlog"></div>

      <script>
         var socketio = io.connect();

         // given to us
         socketio.on("message_to_client",function(data) {
            //Append an HR thematic break and the escaped HTML of the new message
            document.getElementById("chatlog").appendChild(document.createElement("hr"));
            document.getElementById("chatlog").appendChild(document.createTextNode(data['message']));
         });

         // send message (given to us)
         function sendMessage(){
            var msg = document.getElementById("message_input").value;
            socketio.emit("message_to_server", {message:msg});
         }
      
         // join or create a room
         function join_create_room(){
            let username = document.getElementById('username').value;
            let existing_rooms = document.getElementById("existing_rooms");
            let roomName = existing_rooms.options[existing_rooms.selectedIndex].value;
            let create_room = document.getElementById('create_room');
            let is_private = document.getElementById('is_private');
            let roomPassword = document.getElementById('roomPassword').value;

            // if the checkboxes are clicked, then show the rest of the form
            if(creat_room.checked) {
                roomName = document.getElementById("roomName").value;
            }

            socketio.emit("join_room", {
                username: username,
                roomName: roomName,
                isPrivate: isPrivateCheckbox.checked,
                roomPassword: roomPassword
            });
         }

         // event listeners for checkboxes in login Form
         document.getElementById("create_room").addEventListener("change", function() {
            let roomName = document.getElementById("roomName");
            if (this.checked) {
                roomName.style.display = "block";
            } 
         });

         document.getElementById("is_private").addEventListener("change", function() {
            let roomPassword = document.getElementById("roomPassword");
            if (this.checked) {
                roomPassword.style.display = "block";
            } 
         });

         // event listener for form submission
         document.getElementById('loginForm').addEventListener('submit', function(event) {
            event.preventDefault(); 
            join_create_room();
         });
      </script>
   </body>
</html>